# üéØ TORP Advanced Scoring System - Documentation Technique

## üìê Architecture G√©n√©rale

### Structure Hi√©rarchique Multi-Niveaux

```
Score Total : 1200 points
‚îú‚îÄ‚îÄ Niveau 1 : 8 Axes Principaux (macro-analyse)
‚îú‚îÄ‚îÄ Niveau 2 : 45 Sous-crit√®res (m√©so-analyse)
‚îî‚îÄ‚îÄ Niveau 3 : 250+ Points de contr√¥le (micro-analyse)
```

### Pond√©ration Adaptative par Profil

- **B2C (Particuliers)** : S√©curisation + Prix + Transparence
- **B2B (Professionnels)** : Conformit√© + Innovation + Performance

## üîç D√©tail des 8 Axes

### AXE 1 : CONFORMIT√â R√âGLEMENTAIRE & TECHNIQUE (350 points - 29%)

#### 1.1 Respect Normes DTU & Standards (140 points)

**DTU Sp√©cifiques M√©tier (50 points)**
- Identification automatique DTU applicables (15 pts)
  - Donn√©es : Corps d'√©tat d√©tect√©s, type travaux, localisation
  - Source : Base CSTB, analyse NLP du devis
  - Algorithme : Mapping automatique m√©tier ‚Üí DTU via IA

- Coh√©rence mat√©riaux/techniques pr√©conis√©es (20 pts)
  - Donn√©es : Sp√©cifications mat√©riaux, techniques de mise en ≈ìuvre
  - Source : Descriptif devis, fiches techniques produits
  - Algorithme : Validation crois√©e mat√©riaux ‚Üî DTU ‚Üî techniques

- Respect clauses techniques obligatoires (15 pts)
  - Donn√©es : Clauses DTU, descriptif technique d√©taill√©
  - Source : Base DTU CSTB, analyse s√©mantique devis
  - Algorithme : Score de conformit√© par clause critique

**Certifications Produits & Marquages (40 points)**
- V√©rification marquage CE automatique (15 pts)
- Conformit√© normes NF/ACERMI (15 pts)
- Tra√ßabilit√© certifications (10 pts)

**Performance √ânerg√©tique RE2020 (50 points)**
- Seuils r√©glementaires Bbio/Cep/Cepnr (30 pts)
- Impact carbone Ic √©nergie/composants (20 pts)

#### 1.2 Qualifications & Certifications Entreprise (110 points)

**Qualifications M√©tier Obligatoires (45 points)**
- Qualification Qualibat/Qualifelec adapt√©e (20 pts)
- Niveau qualification suffisant (15 pts)
- Certifications RGE si applicable (10 pts)

**Statut Juridique & Conformit√© (35 points)**
- SIRET valide et activit√© correspondante (15 pts)
- Situation fiscale et sociale r√©guli√®re (10 pts)
- Absence proc√©dures collectives (10 pts)

**Assurances Professionnelles (30 points)**
- RC D√©cennale valide et couvrante (20 pts)
- RC Professionnelle appropri√©e (10 pts)

#### 1.3 S√©curit√© & Accessibilit√© (100 points)

- S√©curit√© Incendie (40 pts)
- Accessibilit√© PMR (30 pts)
- Performance Acoustique (30 pts)

### AXE 2 : ANALYSE PRIX & MARCH√â (250 points - 21%)

#### 2.1 Positionnement Tarifaire (120 points)

**Benchmarking Multi-Sources (60 points)**
- Position vs m√©diane r√©gionale (30 pts)
- Coh√©rence prix unitaires (20 pts)
- Adaptation contexte g√©ographique (10 pts)

**Analyse Ratios Sectoriels (40 points)**
- R√©partition mat√©riaux/main d'≈ìuvre (20 pts)
- Marge entreprise estim√©e (10 pts)
- √âvolution temporelle prix (10 pts)

**D√©tection Anomalies Tarifaires (20 points)**
- Alertes prix aberrants (15 pts)
- Incoh√©rences internes devis (5 pts)

#### 2.2 Optimisation Valeur (80 points)

- Rapport Qualit√©/Prix (50 pts)
- Potentiel N√©gociation (30 pts)

#### 2.3 Intelligence Financi√®re (50 points)

- Modalit√©s Paiement (25 pts)
- Optimisation Fiscale (25 pts)

### AXE 3 : QUALIT√â & R√âPUTATION ENTREPRISE (200 points - 17%)

#### 3.1 Solidit√© Financi√®re (80 points)

- Sant√© √âconomique (50 pts)
  - √âvolution chiffre d'affaires (20 pts)
  - R√©sultats financiers (15 pts)
  - Capacit√© projet (15 pts)

- Pr√©diction D√©faillance (30 pts)
  - Score risque Banque de France (15 pts)
  - Mod√®le pr√©dictif TORP (15 pts)

#### 3.2 R√©putation & R√©f√©rences (70 points)

- Satisfaction Client (40 pts)
- Portfolio & R√©alisations (30 pts)

#### 3.3 Capital Humain & Organisation (50 points)

- Moyens Humains (30 pts)
- Moyens Mat√©riels (20 pts)

### AXE 4 : FAISABILIT√â & COH√âRENCE TECHNIQUE (150 points - 12%)

#### 4.1 Pertinence Solutions (70 points)

- Ad√©quation Technique (40 pts)
- Innovation Ma√Ætris√©e (30 pts)

#### 4.2 R√©alisme Ex√©cution (50 points)

- Planning & Ressources (30 pts)
- Contraintes Chantier (20 pts)

#### 4.3 Gestion Risques (30 points)

- Identification Risques (20 pts)
- Mesures Pr√©ventives (10 pts)

### AXE 5 : TRANSPARENCE & COMMUNICATION (100 points - 8%)

#### 5.1 Qualit√© Documentation (50 points)

- Clart√© Devis (30 pts)
- Plans & Techniques (20 pts)

#### 5.2 Relation Client (30 points)

- Professionnalisme (20 pts)
- R√©activit√© (10 pts)

#### 5.3 Suivi Projet (20 points)

- Accompagnement (15 pts)
- Service Apr√®s-Vente (5 pts)

### AXE 6 : GARANTIES & ASSURANCES (80 points - 7%)

#### 6.1 Couvertures L√©gales (50 points)

- Garanties Obligatoires (35 pts)
- Assurances Professionnelles (15 pts)

#### 6.2 Extensions & Garanties Commerciales (30 points)

- Garanties √âtendues (20 pts)
- Protection Financi√®re (10 pts)

### AXE 7 : INNOVATION & D√âVELOPPEMENT DURABLE (50 points - 4%)

#### 7.1 Performance Environnementale (30 points)

- Solutions Bas Carbone (20 pts)
- D√©marche √âcologique (10 pts)

#### 7.2 Innovation Technique (20 points)

- Technologies Avanc√©es (15 pts)
- Veille & Formation (5 pts)

### AXE 8 : GESTION PROJET & D√âLAIS (70 points - 6%)

#### 8.1 R√©alisme Planning (40 points)

- Coh√©rence Temporelle (25 pts)
- Coordination M√©tiers (15 pts)

#### 8.2 Capacit√© Respect D√©lais (30 points)

- Historique Performance (20 pts)
- Engagement Contractuel (10 pts)

## üîó Sources de Donn√©es & APIs

### APIs Publiques Officielles (Gratuites)

‚úÖ **INSEE Sirene** (data.gouv.fr)
- Endpoint : `https://recherche-entreprises.api.gouv.fr`
- Cl√© API : Non requise
- Donn√©es : SIRET, activit√©, adresse, statut juridique

‚úÖ **BODACC** (data.gouv.fr)
- Proc√©dures collectives
- Avis de proc√©dures judiciaires

‚úÖ **Data.gouv.fr**
- Datasets multiples
- APIs vari√©es selon besoins

### APIs Sectorielles (Optionnelles - Cl√©s API requises)

üîë **Infogreffe**
- Variables : `INFOGREFFE_API_KEY`, `INFOGREFFE_API_URL`
- Donn√©es : Bilans comptables, proc√©dures, dirigeants

üîë **Pappers.fr**
- Variables : `PAPPERS_API_KEY`, `PAPPERS_API_URL`
- Donn√©es : Enrichissement entreprises, scores

üîë **Qualibat**
- Certifications m√©tiers
- Qualifications professionnelles

üîë **CSTB Premium**
- Base DTU compl√®te
- Guides techniques

üîë **Reef Premium**
- Variables : `REEF_PREMIUM_API_KEY`, `REEF_PREMIUM_API_URL`
- Prix de r√©f√©rence mat√©riaux/prestations

### APIs M√©t√©o (Optionnelles)

üîë **OpenWeather**
- Variables : `OPENWEATHER_API_KEY`
- Donn√©es m√©t√©orologiques r√©elles

üîë **M√©t√©o France**
- Variables : `METEOFRANCE_API_KEY`
- Donn√©es officielles fran√ßaises

## üöÄ Utilisation

### Enrichissement Automatique

L'enrichissement est **automatiquement appel√©** lors de l'upload d'un devis :

```typescript
// Dans app/api/llm/analyze/route.ts
const enrichmentService = new AdvancedEnrichmentService()
const enrichmentData = await enrichmentService.enrichForScoring(
  extractedData,
  'renovation',
  'plomberie',
  'ILE_DE_FRANCE'
)
```

### Scoring Avanc√©

```typescript
import { AdvancedScoringEngine } from '@/services/scoring/advanced/advanced-scoring-engine'

const engine = new AdvancedScoringEngine()
const score = await engine.calculateScore(
  devis,
  enrichmentData,
  {
    profile: 'B2C',
    projectType: 'renovation',
    projectAmount: 'medium',
    region: 'ILE_DE_FRANCE'
  }
)
```

## ‚öôÔ∏è Configuration

### Variables d'Environnement

```env
# APIs Enrichissement (Optionnelles)
INFOGREFFE_API_KEY=votre_cle
INFOGREFFE_API_URL=https://api.infogreffe.fr/v1

PAPPERS_API_KEY=votre_cle
PAPPERS_API_URL=https://api.pappers.fr/v2

REEF_PREMIUM_API_KEY=votre_cle
REEF_PREMIUM_API_URL=https://api.reef-premium.fr/v1

OPENWEATHER_API_KEY=votre_cle
METEOFRANCE_API_KEY=votre_cle
```

**Note** : L'API Sirene (data.gouv.fr) fonctionne **sans cl√© API** - elle est gratuite et directement utilisable.

## üìä Recommandations Automatiques

Le syst√®me g√©n√®re des recommandations actionnables selon le grade :

- **Grade A+** : Validation rapide, marge n√©gociation 2-5%
- **Grade A** : N√©gociations mineures, marge 5-10%
- **Grade B** : V√©rifications cibl√©es, marge 10-15%
- **Grade C** : Analyse approfondie, ren√©gociation 15-20%
- **Grade D/E** : Recherche alternatives, due diligence

## üîÑ Roadmap d'Impl√©mentation

### Phase 1 - Core Engine (8 semaines) ‚úÖ EN COURS
- Axes 1-3 : Conformit√© + Prix + Qualit√©
- APIs de base : INSEE, Infogreffe (fallback)
- Scoring simple avec seuils fixes

### Phase 2 - Intelligence Avanc√©e (12 semaines)
- Axes 4-5 : Faisabilit√© + Transparence
- Machine Learning : Mod√®les pr√©dictifs
- Pond√©ration adaptative B2C/B2B

### Phase 3 - Expertise Compl√®te (16 semaines)
- Axes 6-8 : Garanties + Innovation + D√©lais
- NLP avanc√© : Analyse s√©mantique compl√®te
- Auto-apprentissage : Optimisation continue

### Phase 4 - √âcosyst√®me (20 semaines)
- APIs partenaires : Fabricants, distributeurs
- Marketplace : Recommandations entreprises
- IA g√©n√©rative : Conseils personnalis√©s

